(self.webpackChunkvk=self.webpackChunkvk||[]).push([[85228],{440624:(e,t,i)=>{"use strict";i.d(t,{default:()=>C});i(821249),i(241539),i(339714),i(804723),i(115306),i(323123),i(454747);var s=i(487976),o=i(840060),r=i(769488),a=i(733164),d=i(873589),n=i(608021),l=i(342269),h=i(897449),c=i(965354),p=i(927766),v=i(146143),_=i(549357),u=i(455145),g=280;class C{constructor(e,t,i,s,o,r,a,d){this.groupId=e,this.showHash=t,this.addressId=i,this.isInline=null!=s&&s,this.onSaveHandler=null!=o?o:null,this.map={},this.placeSelector={},this.citySelector={},this.citySelectorEdit={},this.box={},this.confirmationBox={},this.addressGeocodeTimer=null,this.onShowCallback=null!=r?r:null,this.onDestroyCallback=null!=a?a:null,this.onDeleteCallback=null!=d?d:null}deleteAddressOnConfirmation(e,t,i,s){e.confirmationBox.hide(),e.deleteAddress(t,i,s,!0)}deleteAddress(e,t,i,s){if((0,h.linkLocked)(e))return!1;if(!s){var o=this.getAddress();o.title=o.title.replace(/</g,"&lt;").replace(/>/g,"&gt;");var r=(0,n.getLang)("groups_edit_address_delete_confirmation_message",o.title),a=this.deleteAddressOnConfirmation.pbind(this,e,t,i);return this.confirmationBox=(0,v.showFastBox)({title:(0,n.getLang)("groups_edit_address_delete_confirmation_title")},r,(0,n.getLang)("groups_edit_address_delete_confirmation_yes"),a,(0,n.getLang)("global_cancel")),!1}var d,l={act:"delete_address",id:this.groupId,address_id:t,hash:i};d=this.onDeleteCallback?()=>{this.isChanged=!1,this.box.hide(),this.onDeleteCallback()}:this.onAddressDelete.bind(this),ajax.post("groupsedit.php",l,{onDone:d,showProgress:h.lockLink.pbind(e),hideProgress:h.unlockLink.pbind(e)})}onAddressDelete(e){var t=e.address_id,i=e.main_address_id,s=void 0===i?null:i,o=(0,d.ge)("groups_edit_address_block_"+t);(0,d.re)(o),0==(0,d.geByClass)("groups_edit_address_block").length&&(0,d.show)("groups_edit_empty_placeholder"),this.isChanged=!1,this.box.hide(),window.GroupsEdit.invalidateBack();var r="<b>"+(0,n.getLang)("global_changes_saved")+"</b><br/>"+(0,n.getLang)("groups_address_edit_delete_address_success");window.GroupsEdit.showMessage(r),this.setCount(-1),null!==s&&window.GeAddresses.setMainAddressId(s)}setCount(e){var t=(0,d.geByClass1)("groups_edit_addresses_new_count_left"),i=(0,l.intval)((0,d.attr)(t,"data-left-count"));i-=e;var s="("+(0,n.langStr)((0,n.getLang)("groups_address_edit_left_count"),"%s",i)+")";(0,d.val)(t,s),(0,d.attr)(t,"data-left-count",i);var o="groups_edit_addresses_edit_new";i<=0?(0,d.hide)(o):(0,d.show)(o),i>=10?(0,d.hasClass)(t,"unshown")||(0,d.addClass)(t,"unshown"):(0,d.hasClass)(t,"unshown")&&(0,d.removeClass)(t,"unshown")}onClean(){this.map.removeMap(),this.placeSelector.destroy(),this.citySelector.destroy(),this.citySelectorEdit.destroy()}create(){var e={act:"edit_address_box",id:this.groupId,hash:this.showHash,is_inline:+this.isInline};this.addressId&&(e.address_id=this.addressId);var t={onDone:this.onShowBoxDone.bind(this),containerClass:"address_box "+(this.addressId?"address_box_edit":"address_box_add"),params:{onHideAttempt:this.onHideAttempt.bind(this)}};this.onDestroyCallback&&(t.params.onDestroy=this.onDestroyCallback),(0,v.showBox)("groupsedit.php",e,t)}onShowBoxDone(e,t){this.box=e,this.box.setOptions({width:570,bodyStyle:"padding: 0",onClean:this.onClean.bind(this)}),this.initBox(t),this.onShowCallback&&this.onShowCallback()}onHideAttempt(e){if(!this.isChanged||e)return!0;if(this.isChanged){var t=(0,v.showFastBox)({title:(0,n.getLang)("global_warning"),bodyStyle:"padding: 20px; line-height: 160%;"},(0,n.getLang)("groups_address_edit_close_warning"),(0,n.getLang)("global_continue"),(()=>{this.isChanged=!1,t.hide(),this.box.hide(!0)}),(0,n.getLang)("global_cancel"));return!1}}onAddressGeocoderTimeout(){if(!this.latLonGeocode){var e=this.getAddress();this.needUpdatePlaceSelector=!0,this.geocoder.geocode({address:e.geocoderString})}}addressInputOnChange(){this.addressGeocodeTimer&&(clearTimeout(this.addressGeocodeTimer),this.addressGeocodeTimer=null),this.addressGeocodeTimer=setTimeout(this.onAddressGeocoderTimeout.bind(this),2e3)}initBox(e){this.editAddressPlaceTitle=(0,d.ge)("edit_address_title_inp"),this.editAddressPlaceAddress=(0,d.ge)("edit_address_address_inp"),this.editAddressPlaceAddress.addEventListener("input",this.addressInputOnChange.bind(this)),this.editAddressPlaceAdd=(0,d.ge)("edit_address_additional_inp"),(0,_.autosizeSetup)(this.editAddressPlaceAdd,{minHeight:68,maxHeight:110}),this.editAddressPlacePhone=(0,d.ge)("address_phone"),this.editAddressPlaceItsMain=(0,d.ge)("address_its_main"),this.editAddressPlaceSetAsMainBlock=(0,d.ge)("address_set_as_main_block");var t=cur.addressData;window.selectsData.setCountries(t.countries),t.country&&window.selectsData.setCities(t.country[0],t.cities),this.metroSelector=new window.StationSelect((0,d.ge)("place_metro"),(0,d.ge)("edit_address_metro"),{width:g,forceEnableCustom:1,noBlur:!0,big:1,station_color:1}),this.placeSelector=new s.PlacesSelect((0,d.ge)("place_address"),(0,d.ge)("address_row"),{width:g,forceEnableCustom:1,noBlur:!0,big:1,showAddress:1,showCreateNewPlace:1});var i={width:g,country:t.country,placeSelect:this.placeSelector,stationSelectWithColor:this.metroSelector,ignoreCountry:!0,big:1},r={width:g,country:t.country,big:1,ignoreCountry:!0};o.browser.msie&&o.browser.version<=11&&(i.liteEventsBind=!0,r.liteEventsBind=!0),this.citySelector=new window.CitySelect((0,d.ge)("place_city"),(0,d.ge)("city_row"),i),this.citySelectorEdit=new window.CitySelect((0,d.ge)("place_city_edit"),(0,d.ge)("city_row_edit"),r),this.isEditScreen=e.address,t.city&&(this.citySelector.val(t.city,!0),this.citySelectorEdit.val(t.city,!0)),this.citySelector.setOptions({onChange:this.citySelectorOnChange.bind(this)}),this.citySelectorEdit.setOptions({onChange:this.citySelectorEditOnChange.bind(this)}),this.placeSelector.setOptions({onChange:this.placeSelectorOnChange.bind(this),onCreateNew:this.placeSelectorOnCreateNew.bind(this)}),Array.prototype.forEach.call((0,d.geByClass)("time_input"),(e=>{new u.default({element:e})})),this.saveHash=e.saveHash,e.address?(this.delHash=e.delHash,this.initEditAddress(e)):this.initNewAddress()}placeSelectorOnCreateNew(e){(this.geocodeCurrentLatLon(),e)||(e=this.placeSelector.val_full()[1]);e&&(0,d.val)(this.editAddressPlaceTitle,e),this.nextCreateStep()}setEditAddress(e,t,i,s){(0,d.val)(this.editAddressPlaceTitle,e),(0,d.val)(this.editAddressPlaceAddress,(0,l.unclean)(t)),(0,d.val)(this.editAddressPlaceAdd,i),(0,d.val)(this.editAddressPlaceMetro,"")}initEditAddress(e){var t=e.address;this.setEditAddress(t.title,t.address,t.additional_address),this.metroSelector.val(t.metro_id,!0),this.curAddress=t,this.needInitMap=!0,this.initMapBox(),this.isEditScreen=!0,this.isChanged=!0,(0,d.hide)("groups_edit_address_select_new"),(0,d.show)("edit_address"),(0,d.show)("public_place_map"),(0,d.show)("edit_timetable"),this.box.setButtons((0,n.getLang)("global_save"),this.boxSavePlace.bind(this),(0,n.getLang)("global_cancel"));var i=(0,d.ce)("a",{innerHTML:(0,n.getLang)("groups_edit_address_delete")});i.addEventListener("click",(()=>{this.deleteAddress(i,t.id,e.delHash)})),this.box.controlsTextNode.appendChild(i),this.box.updateBoxCoords()}updateMapAndPlaceSelector(e,t,i,s){this.box.showProgress(),s&&this.map.setBounds(s),i||(i=new window.vkMaps.LatLonPoint(e,t)),this.setMarker(i),this.map.setCenterAndZoom(i,14),this.updatePlaceLatLon(e,t),this.box.hideProgress()}updatePlaceLatLon(e,t){if(!e||!t){var i=this.map.getCenter();e=i.lat,t=i.lon}this.placeSelector.setOptions({latitude:e,longitude:t})}setMarker(e){!1!==this.marker&&((0,r.debugLog)("removing marker"),this.map.removeMarker(this.marker)),this.marker=new window.vkMaps.Marker(e),this.marker.dragend.addHandler(this.onDragMarker,this),this.map.addMarkerWithData(this.marker,{draggable:!0,infoBubble:!1,icon:"/images/map/move.png",icon2x:"/images/map/move_2x.png",iconSize:[26,23],iconAnchor:[7,23]})}geocodeCurrentLatLon(e){this.latLonGeocode=!0,e||(e=this.map.getCenter()),this.geocoder.geocode(e)}onGeocoderSuccess(e){var t=!0;if(this.latLonGeocode&&(this.latLonGeocode=!1,t=!1),t){var i=e.point,s=e.bounds;this.updateMapAndPlaceSelector(i.lat,i.lon,i,s)}else this.onLatLonDecode(e)}onLatLonDecode(e){e.text_name&&(0,d.val)(this.editAddressPlaceAddress,(0,l.unclean)(e.text_name))}onGeocoderFailure(e){this.updatePlaceLatLon(0,0)}onMapLoadHandler(){this.map.setOptions({enableScrollWheelZoom:!0}),this.map.addSmallControls();var e=this.onGeocoderSuccess.bind(this),t=this.onGeocoderFailure.bind(this);this.geocoder=new window.vkMaps.Geocoder("yandex2",e,t),this.needInitMap&&(this.curAddress?this.updateMapAndPlaceSelector(this.curAddress.latitude,this.curAddress.longitude):this.getGeocoderStringAndUpdate()),this.box.hideProgress()}getAddress(){var e={geocoderString:""},t=(0,l.intval)(this.citySelector.val());if(t>0){var i=this.citySelector.val_full();if(e.cityId=t,i[2]){var s=i[2].split(",");e.geocoderString+=","+s[0]+", "+i[1]}else e.geocoderString+=", "+this.citySelector.val_full()[1]}return e.title=(0,d.val)(this.editAddressPlaceTitle),e.address=(0,d.val)(this.editAddressPlaceAddress),e.address&&(e.geocoderString+=", "+e.address),e.additional=(0,d.val)(this.editAddressPlaceAdd),this.marker&&(e.lat=this.marker.location.lat,e.lon=this.marker.location.lon),this.selectedPlaceId&&(e.placeId=this.selectedPlaceId),e.metroId=(0,l.intval)(this.metroSelector.val()),e.geocoderString=e.geocoderString.replace(/<\/?[^>]+>/g,""),e.phone=(0,d.val)(this.editAddressPlacePhone),this.editAddressPlaceItsMain&&(e.isMain=(0,h.isChecked)(this.editAddressPlaceItsMain)),this.editAddressPlaceSetAsMainBlock&&(e.isSetAsMainBlock=(0,h.isChecked)(this.editAddressPlaceSetAsMainBlock)),e}onDragMarker(e,t){this.geocodeCurrentLatLon(t.location)}initMapBox(){var e=cur.mapProvider,t=cur.mapProviders,i="place_map_"+e;for(var s in this.box.showProgress(),t)if(t[s]){var o=t[s];s!=e&&(0,a.isArray)(o)&&(0,d.isVisible)("place_map_"+o)&&(0,d.hide)("place_map_"+o),(0,d.isVisible)("place_map_"+e)||(0,d.show)(i)}var r={provider:e,lngcode:(0,n.getLang)("wall_google_maps_lang")};this.map=new window.vkMaps.VKMap(i,r),this.map.isLoaded(e)?this.onMapLoadHandler():this.map.load.addHandler(this.onMapLoadHandler,this)}initNewAddress(){this.showNewAddress(),this.needInitMap=!0,this.initMapBox(),this.initCreateStep(),this.nextCreateStep()}showNewAddress(){this.isEditScreen=!1,(0,d.hide)("edit_address"),(0,d.hide)("edit_timetable"),(0,d.show)("groups_edit_address_select_new"),(0,d.hide)("public_place_map"),this.placeSelector.val(""),this.box.setButtons((0,n.getLang)("global_continue"),(()=>{this.geocodeCurrentLatLon();var e=this.placeSelector.val_full()[1];e&&(0,d.val)(this.editAddressPlaceTitle,e),this.nextCreateStep()}),(0,n.getLang)("global_cancel")),this.placeSelector.focus()}getGeocoderStringAndUpdate(){var e=this.getAddress();this.geocoder.geocode({address:e.geocoderString})}citySelectorEditOnChange(e){this.isEditScreen&&(this.citySelector.receivedData=this.citySelectorEdit.receivedData,this.citySelector.val(e,!0),this.getGeocoderStringAndUpdate(),(0,d.val)(this.editAddressPlaceAddress,""))}citySelectorOnChange(e){this.isEditScreen||(this.citySelectorEdit.receivedData=this.citySelector.receivedData,this.citySelectorEdit.val(e,!0)),this.getGeocoderStringAndUpdate()}placeSelectorOnChange(e){if(e<=0)return!1;var t=this.placeSelector.val_full(),i=t[2],s=t[3],o=t[4],r=t[5];this.updateMapAndPlaceSelector(i,s),this.setEditAddress(o,r),this.selectedPlaceId=(0,l.intval)(e),this.curAddress=this.getAddress(),this.nextCreateStep()}isAddressValid(e){return e.cityId?!e.title||e.title.length>255?((0,h.notaBene)(this.editAddressPlaceTitle),!1):!e.address||e.address.length>255?((0,h.notaBene)(this.editAddressPlaceAddress),!1):!(e.additional.length>=400)||((0,h.notaBene)(this.editAddressPlaceAdd),!1):((0,h.notaBene)(this.citySelectorEdit.container),this.citySelectorEdit.input.focus(),!1)}boxSavePlace(e){if(!(0,d.isVisible)(this.box.progress)&&!(0,h.isButtonLocked)(e)){var t={};t.id=cur.groupId,t.hash=this.saveHash;var i=this.getAddress();if(!this.isAddressValid(i))return!1;t.title=i.title,t.address=i.address,t.additional=i.additional,t.city_id=i.cityId,t.lat=i.lat,t.lon=i.lon,t.place_id=i.placeId?i.placeId:0,i.metroId&&(t.metro_id=i.metroId),t.act="save_address",this.addressId&&(t.address_id=this.addressId),i.hasOwnProperty("isMain")&&(t.is_main=i.isMain),i.hasOwnProperty("isSetAsMainBlock")&&(t.main_section=i.isSetAsMainBlock),i.phone&&(t.phone_0=i.phone);var s=(0,c.collectAddress)(this.box.bodyNode);if(!1===s)return!1;var o=s[1];Object.keys(o).forEach((e=>{t[e]=o[e]})),t.is_inline=+this.isInline,ajax.post("groupsedit.php",t,{onDone:this.onSaveDone.bind(this),showProgress:()=>(0,h.lockButton)(e),hideProgress:()=>(0,h.unlockButton)(e)})}}onSaveDone(e){if(e.status||!e.errors)if(this.isChanged=!1,this.box.hide(),this.isInline)this.onSaveHandler&&this.onSaveHandler(e);else{var t=e.address_id,i=e.address_edit_html,s=e.main_address_id,o=void 0===s?null:s;window.GroupsEdit.invalidateBack();var r=(0,d.ge)("groups_edit_address_block_"+t);if(r){var a="<b>"+(0,n.getLang)("global_changes_saved")+"</b><br/>"+(0,n.getLang)("groups_address_edit_edit_address_success");window.GroupsEdit.showMessage(a),(0,d.domReplaceEl)(r,i),o&&window.GeAddresses.setMainAddressId(o)}else{var l="<b>"+(0,n.getLang)("global_changes_saved")+"</b><br/>"+(0,n.getLang)("groups_address_edit_add_address_success");window.GroupsEdit.showMessage(l);var h=(0,d.domLC)((0,d.ge)("group_edit_addresses_edit_list"));h?(0,d.domInsertAfter)((0,d.se)(i),h):((0,d.ge)("group_edit_addresses_edit_list").appendChild((0,d.se)(i)),(0,d.hide)("groups_edit_empty_placeholder")),(0,p.scrollToY)((0,d.getXY)((0,d.ge)("groups_edit_address_block_"+t))[1],400),this.setCount(1)}}else{var v=e.errors;Object.keys(v).forEach((e=>{var t=v[e];if(t)if("phone"===e){var i=(0,d.ge)("address_phone");(0,c.showAlert)(i,t)}else if(e.match("time")){var s=e.replace("time",""),o=(0,d.ge)("group_edit_addresses_timetable"),r=(0,d.geByClass1)("timetable_"+s,o),a=(0,d.geByClass1)("time_close",r);(0,c.showAlert)(a,t)}}))}}showEditAddress(){this.isEditScreen=!0,(0,d.hide)("groups_edit_address_select_new"),(0,d.hide)("edit_timetable"),(0,d.show)("edit_address"),(0,d.show)("public_place_map"),2!==this.createEndStep?this.box.setButtons((0,n.getLang)("global_continue"),this.nextCreateStep.bind(this),(0,n.getLang)("global_back"),this.prevCreateStep.bind(this)):this.box.setButtons((0,n.getLang)("global_save"),this.boxSavePlace.bind(this),(0,n.getLang)("global_back"),this.prevCreateStep.bind(this)),this.box.updateBoxCoords()}showEditTimetable(){(0,d.hide)("groups_edit_address_select_new"),(0,d.hide)("edit_address"),(0,d.hide)("public_place_map"),(0,d.show)("edit_timetable"),this.box.setButtons((0,n.getLang)("global_save"),this.boxSavePlace.bind(this),(0,n.getLang)("global_back"),this.prevCreateStep.bind(this)),this.box.updateBoxCoords()}initCreateStep(){(0,l.isUndefined)(this.createStep)&&(this.createEndStep=this.needShowTimetable()?3:2,this.createStep=0,this.createStepNode=(0,d.ce)("span"),this.createStepNode.classList.add("address_create_step"),this.box.controlsTextNode.appendChild(this.createStepNode))}nextCreateStep(){++this.createStep,this.updateCreateStep()}prevCreateStep(){--this.createStep,this.updateCreateStep()}updateCreateStep(){if(this.createStep>=2&&(this.isChanged||(this.isChanged=!0)),1===this.createStep)this.showNewAddress();else if(2===this.createStep)this.showEditAddress();else if(3===this.createStep){var e=this.getAddress();if(!this.isAddressValid(e))return--this.createStep,!1;this.showEditTimetable()}this.createStepNode.innerHTML=(0,n.getLang)("groups_edit_address_create_step").replace("{curr}",this.createStep.toString()).replace("{end}",this.createEndStep.toString()),1!==this.createStep?this.box.setBackTitle((()=>this.prevCreateStep())):(0,d.geByClass1)("box_title",this.box.titleWrap).innerHTML=(0,n.getLang)("groups_edit_new_address_time_box_title"),this.box.updateBoxCoords()}needShowTimetable(){return!(0,d.hasClass)("page_add_place_box","group_event")}}},455145:(e,t,i)=>{"use strict";i.d(t,{default:()=>a});i(682772),i(804723),i(323123);var s=i(152278),o=i(342269),r=i(965354);class a{constructor(e){var t=e.element;this.props={element:t},(0,s.addEvent)(t,"keyup",this.onKeyUp.bind(this)),(0,s.addEvent)(t,"keypress",this.onKeyPressed.bind(this)),(0,s.addEvent)(t,"paste drop",this.onPaste.bind(this)),(0,s.addEvent)(t,"blur",this.onBlur.bind(this))}isValid(e){return void 0===e&&(e=this.props.element.value),e.match(/^(\d{1,2})(:(\d{1,2})?)?$/)}onKeyUp(e){var t=this.props.element,i=Number(e.keyCode);if(i===s.KEY.BACKSPACE||i===s.KEY.DELETE)return!0;if(t.value.match(/^(\d{3,})$/)&&(t.value=t.value.substring(0,2)+":"+t.value.substring(2)),!this.isValid()){var o=t.value.split(":"),r=o[0],a=o[1],d=void 0===a?null:a,n=t.selectionStart;t.value=r.substr(0,2),d&&d.length&&(t.value+=":"+d.substr(0,2)),t.selectionStart=n,t.selectionEnd=n}return!0}onKeyPressed(e){var t,i=this.props.element,o=0;if(null!=e.charCode?o=e.charCode:null!=e.which?o=e.which:null!=e.keyCode&&(o=e.keyCode),!o)return!0;var r=i.value.indexOf(":");if(r<=2){var a=i.value.substring(0,i.selectionStart)+i.value.substring(i.selectionEnd),d=a.split(":"),n=d[0],l=d[1],h=void 0===l?null:l,c=n.length,p=null!==h?h.length:0;if(t=String.fromCharCode(o),a.length<5&&t.match(/\d|:/))if(":"===t){if(-1===r)return!0}else{var v=-1===r||r>=i.selectionStart;if(v&&(c<2||-1===r))return!0;if(!v&&p<2)return!0}if(e.altKey||e.ctrlKey||e.metaKey||o<28)return!0}return(0,s.cancelEvent)(e),!1}onPaste(e){var t=this.props.element,i="paste"===e.type?"clipboardData":"drop"===e.type?"dataTransfer":null;if(i){var r=e[i]||e.originalEvent&&e.originalEvent[i];if(r&&r.types&&r.getData){(0,s.cancelEvent)(e);var a=(0,o.clean)(r.getData("text/plain")),d=t.value.substring(0,t.selectionStart)+a+t.value.substring(t.selectionEnd);this.isValid(d)&&(t.value=d)}}}onBlur(){var e=this.props.element.value.split(":"),t=e[0],i=void 0===t?null:t,s=e[1],o=void 0===s?null:s;i=Number(i),o=Number(o),i&&i>23&&(i=23,o=59),o&&o>59&&(o=59),this.setValue(i,o)}setValue(e,t){var i=this.props.element,s="";null===e&&null===t&&(e=0,t=0),null!==e&&(s+=`${e}`),null!==t&&(s+=`:${(0,r.padStart)(t,2,"0")}`),i.value=s}}},965354:(e,t,i)=>{"use strict";i.d(t,{collectAddress:()=>n,showAlert:()=>h,padStart:()=>c});i(57327),i(747042),i(323123),i(454747);var s=i(897449),o=i(873589),r=i(342269),a=i(290846),d=i(152278);function n(e){var t=e=>e.filter(Boolean).join("_"),i={},a=(0,o.attr)(e,"data-address-id"),d=(0,r.intval)(a),n=t(["groups_edit_g_address_timetable_select",d,"input"]),h=(0,o.ge)(n);if(!h)return!1;var c=(0,r.intval)((0,o.val)(h));i["workday_type_"+d]=c;var p=t(["address_phone",d]),v=(0,o.ge)(p);v&&(i["phone_"+d]=(0,o.val)(v));var _=t(["group_edit_addresses_timetable",d]),u=(0,o.ge)(_);if(2===c&&(0,o.isVisible)(u)){var g={},C=(0,o.geByClass)("timetable_day",u),m={};C.forEach((e=>{var t=(0,o.geByClass1)("timetable_checkbox",e),i=t&&(0,s.isChecked)(t)?1:0,r=(0,o.attr)(e,"data-day-id");if(m[r]=e,g["is_wday_"+r]=i,i){var a=(0,o.geByClass1)("time_open",e);l(a,r),m["time_open_"+r]=a,a&&(g["time_open_"+r]=(0,o.val)(a));var d=(0,o.geByClass1)("time_close",e);l(d,r),m["time_close_"+r]=d,d&&(g["time_close_"+r]=(0,o.val)(d));var n=(0,o.geByClass1)("timetable_break",e);if((0,o.isVisible)(n)){g["is_bday_"+r]=1;var h=(0,o.geByClass1)("time_break_start",e);l(h,r),m["time_break_start_"+r]=h,h&&(g["time_break_start_"+r]=(0,o.val)(h));var c=(0,o.geByClass1)("time_break_end",e);l(c,r),m["time_break_end_"+r]=c,c&&(g["time_break_end_"+r]=(0,o.val)(c))}else g["is_bday_"+r]=0}})),g&&Object.keys(g).forEach((e=>{i[e+"_"+d]=g[e]}))}return[d,i]}function l(e,t){var i,s,r,a,d,n=(0,o.val)(e);(i=n.split(":"),s=i[0],r=i[1],a=parseInt(s),d=parseInt(r),60*a+d)>=1440&&(0,o.val)(e,"23:59")}function h(e,t){!function(e,t){var i,n="INPUT"===e.tagName,l=e;(!n&&(i=(0,o.geByClass1)("selector_table",e))||!n&&(i=(0,o.geByClass1)("radiobtn",e)))&&(l=i);var h=function(){(0,a.showTooltip)(l,{text:t,dir:"left",width:300,typeClass:"ij_tt",shift:[-(0,o.getSize)(l)[0]-15,-(0,o.getSize)(l)[1]/2+2],hasover:1,nohideover:1,onCreate:function(){(0,d.removeEvent)(l,"mouseout"),n&&(l.onblur=function(){l.tt&&l.tt.hide&&l.tt.hide()})}})};n?(e.onfocus=h,(0,s.notaBene)(e)):(h(),(0,r.each)((0,o.geByClass)("selector_table",e),(function(e,t){(0,s.notaBene)(t)})))}(e,t)}function c(e,t,i){return e=String(e),t>>=0,i=String(i||" "),e.length>t?String(e):((t-=e.length)>i.length&&(i+=i.repeat(t/i.length)),i.slice(0,t)+String(e))}},390787:(e,t,i)=>{"use strict";i.d(t,{COVER_UPLOAD_CROP_WIDTH:()=>s,COVER_UPLOAD_WIDTH:()=>o,COVER_REDESIGN_UPLOAD_CROP_WIDTH:()=>r,MainCoverUploadEvents:()=>a,COVER_UPLOAD_CROP_IMG_ID:()=>d,COVER_UPLOAD_SIZE:()=>n,COVER_CROP_DONE_BUTTON:()=>l,COVER_BIG_CROP_RATIO:()=>h});var s=845,o=655,r=965,a={onEditStart:"edit_start",onCropSuccess:"crop_success",onUploadStart:"upload_start",onDragOut:"drag_out",onDragEnter:"drag_enter",onUploadError:"upload_error"},d="owner_photo_img",n=26214400,l="owner_photo_done_edit",h=3},638604:(e,t,i)=>{"use strict";i.d(t,{default:()=>_});i(682772),i(821249),i(241539),i(788674),i(454747);var s=i(873589),o=i(70162),r=i(342269),a=i(501389),d=i(146143),n=i(152278),l=i(897449),h=i(691149),c=i(30522),p=i(390787),v="loading";class _{constructor(e,t,i,s){this.groupId=e,this.reUploadCoverId=0,this.liveCoverPosition=-1,this.box={},this.onCoverSavePromiseResolveFunction=()=>{},this.onCoverSaveCallback=()=>{t&&t(),this.onCoverSavePromiseResolveFunction()},this.needSwitchToEdit=!1,this.onShowCallback=null!=i?i:null,this.onDestroyCallback=null!=s?s:null}showBox(e){void 0===e&&(e=!1),this.needSwitchToEdit=e;var t={id:this.groupId,act:"edit_box"},i={containerClass:"groups_cover_box",params:{hideButtons:!0,width:655},onDone:this.onShowBoxDone.bind(this)};this.onDestroyCallback&&(i.params.onDestroy=this.onDestroyCallback),(0,d.showBox)("groupsedit_cover.php",t,i)}onShowBoxDone(e,t){this.box=e,this.headerEl=(0,s.domQuery1)("#groups_edit_cover_header",this.box.bodyNode),this.contentEl=(0,s.domQuery1)("#groups_edit_cover_wrap",this.box.bodyNode),this.mainCoverEl=(0,s.domQuery1)("#groups_edit_cover_wrap_main_wrap",this.box.bodyNode),this.mainCoverEditEl=(0,s.domQuery1)("#groups_edit_cover_wrap_main_edit",this.box.bodyNode),this.mainCoverImgEl=(0,s.domQuery1)("#groups_edit_cover_wrap_main_edit_img",this.box.bodyNode),this.mainCoverCropEl=(0,s.domQuery1)("#owner_photo_edit",this.box.bodyNode),this.mainCoverUploadEl=(0,s.domQuery1)("#groups_edit_cover_wrap_main_input",this.box.bodyNode),this.mainCoverUploadPlaceholder=(0,s.domQuery1)("#groups_edit_cover_wrap_main_wrap_btn",this.mainCoverEl),this.liveWrapEl=(0,s.domQuery1)("#groups_edit_cover_wrap_live",this.box.bodyNode),this.initEvents(t),this.onShowCallback&&this.onShowCallback(),this.needSwitchToEdit&&(this.needSwitchToEdit=!1,this.box.hide(),this.handleEditClick())}onMainCoverUploadStart(){(0,s.hide)(this.mainCoverEditEl),(0,s.show)(this.mainCoverEl),(0,s.addClass)(this.mainCoverEl,v)}onMainCoverDragEnter(){(0,s.hide)(this.mainCoverUploadPlaceholder)}onMainCoverDragOut(){(0,s.show)(this.mainCoverUploadPlaceholder)}onMainCoverUploadError(){(0,s.removeClass)(this.mainCoverEl,v),(0,s.attr)(this.mainCoverImgEl,"src")&&((0,s.show)(this.mainCoverEditEl),(0,s.hide)(this.mainCoverEl))}initEvents(e){var t=(0,s.domQuery1)(".groups_edit_cover_close",this.box.bodyNode);t&&(0,n.addEvent)(t,"click",(()=>{this.box.hide()}));var i=this.getMainCoverEmitter();this.uploadMain=new h.default(this.groupId,this.mainCoverUploadEl,(0,s.domQuery1)("#owner_photo_thumb",this.mainCoverCropEl),e.upload,i),[(0,s.domQuery1)(".groups_edit_cover_wrap_main_a",this.box.bodyNode),(0,s.domQuery1)(".upload",this.mainCoverEditEl)].forEach((e=>{(0,n.addEvent)(e,"click",(e=>{(0,s.geByTag1)("button",this.mainCoverUploadEl).click()}))}));var o=(0,s.domQuery1)(".delete",this.mainCoverEditEl);o&&(0,n.addEvent)(o,"click",(()=>{var e=(0,s.domData)(o,"hash");Page.deleteOwnerCover(-this.groupId,e,this.onMainCoverDelete.bind(this))}));var r=(0,s.domQuery1)(".edit",this.mainCoverEditEl);r&&(0,n.addEvent)(r,"click",(()=>{this.handleEditClick()}));var a=(0,s.domQuery1)("#groups_edit_cover_wrap_live_upload_input",this.contentEl);if(a&&(0,n.addEvent)(a,"change",(()=>{this.onFileChange(a)})),this.liveWrapEl){this.liveWrapToDrag=(0,s.domQuery1)("#live_covers_to_drag",this.box.bodyNode);var d=new EventEmitter;d.on(c.LiveCoverUploadEvents.onError,this.onUploadErrorLiveCover.bind(this)),d.on(c.LiveCoverUploadEvents.onDidUploaded,this.onDidUploadedLiveCover.bind(this)),d.on(c.LiveCoverUploadEvents.onStart,this.onUploadStartLiveCover.bind(this));var p=this.getLiveCoversCount();this.uploadLive=new c.default(this.groupId,this.liveWrapEl,e.uploadStoryHash,e.saveStoryHash,d,p),this.liveInputEl=(0,s.domQuery1)("#groups_edit_cover_wrap_live_upload_input",this.box.bodyNode),(0,n.addEvent)(this.liveWrapEl,"dragenter dragover",this.dragDidEnter.bind(this)),(0,n.addEvent)(this.liveWrapEl,"dragleave",this.dragDidLeave.bind(this)),(0,n.addEvent)(this.liveWrapEl,"drop",this.dragDidDrop.bind(this)),this.reorderHash=e.reorderHash,this.deleteHash=e.deleteHash,this.initSorter(),this.initLiveCoverEvents()}var v=(0,s.domQuery1)("#groups_edit_cover_scalable",this.contentEl);v&&(0,n.addEvent)(v,"click",(e=>{var t=(0,s.domData)(v,"hash");this.setScalable(v,t)}));var _=(0,s.domQuery1)("#owner_photo_done_edit",this.mainCoverCropEl);_&&(0,n.addEvent)(_,"click",(e=>{(0,l.lockButton)(_),this.editDone(),(0,l.unlockButton)(_)}));var u=(0,s.domQuery1)("#owner_photo_upload_return",this.mainCoverCropEl);u&&(0,n.addEvent)(u,"click",(e=>{this.uploadReturn()}))}handleEditClick(){if(window.GroupsCoverEditor){var e=new Promise((e=>{this.onCoverSavePromiseResolveFunction=e}));this.uploadMain.curEditOptions=this.uploadMain.editOptions,window.GroupsCoverEditor.initCropper({upload:this.uploadMain.curEditOptions,editDone:this.editDone.bind(this),coverSavePromise:e})}else this.uploadMain.edit(!1)}getMainCoverEmitter(){var e=new EventEmitter;return e.on(p.MainCoverUploadEvents.onEditStart,this.onMainCoverEdit.bind(this)),e.on(p.MainCoverUploadEvents.onCropSuccess,this.onMainCoverSave.bind(this)),e.on(p.MainCoverUploadEvents.onUploadStart,this.onMainCoverUploadStart.bind(this)),e.on(p.MainCoverUploadEvents.onDragEnter,this.onMainCoverDragEnter.bind(this)),e.on(p.MainCoverUploadEvents.onDragOut,this.onMainCoverDragOut.bind(this)),e.on(p.MainCoverUploadEvents.onUploadError,this.onMainCoverUploadError.bind(this)),e}initLiveCoverEvents(){(0,s.domQuery)("#live_covers_for_drag .groups_edit_cover_wrap_live_upload_placeholder_enabled",this.box.bodyNode).forEach((e=>{(0,n.removeEvent)(e,"click"),(0,n.addEvent)(e,"click",(t=>{var i=(0,s.domData)(e,"pos");this.liveCoverUpload(t,i)}))})),(0,s.domQuery)("#live_covers_to_drag .groups_edit_cover_wrap_live_upload",this.box.bodyNode).forEach((e=>{var t=(0,s.domQuery1)(".delete",e);(0,n.removeEvent)(t,"click"),(0,n.addEvent)(t,"click",(e=>{this.liveCoverDelete(e)}));var i=(0,s.domQuery1)(".upload",e);(0,n.removeEvent)(i,"click"),(0,n.addEvent)(i,"click",(e=>{this.liveCoverChange(e)}))}))}onMainCoverEdit(){(0,s.hide)(this.contentEl),(0,s.hide)(this.headerEl),(0,s.removeClass)(this.mainCoverEl,v);var e=(0,s.hasClass)(this.mainCoverCropEl,"owner_photo_edit_redesigned")?p.COVER_REDESIGN_UPLOAD_CROP_WIDTH:p.COVER_UPLOAD_CROP_WIDTH;if(window.GroupsCoverEditor){this.box.hide();var t=new Promise((e=>{this.onCoverSavePromiseResolveFunction=e}));window.GroupsCoverEditor.initCropper({width:e,upload:this.uploadMain.curEditOptions,editDone:this.editDone.bind(this),coverSavePromise:t})}else(0,s.show)(this.mainCoverCropEl),this.box.setOptions({width:e})}onMainCoverSave(e,t){if((0,s.attr)(this.mainCoverImgEl,"src",e),(0,s.hide)(this.mainCoverCropEl),(0,s.hide)(this.mainCoverEl),this.box.setOptions({width:p.COVER_UPLOAD_WIDTH}),(0,s.show)(this.contentEl),(0,s.show)(this.headerEl),(0,s.show)(this.mainCoverEditEl),this.box.updateBoxCoords(),this.uploadMain.isAvailableBigCover()){this.contentEl.classList.contains("groups_edit_cover_wrap--big")||this.contentEl.classList.add("groups_edit_cover_wrap--big");var i=(0,s.domQuery1)(".PageCover");i&&!i.classList.contains("PageCover--big")&&i.classList.add("PageCover--big")}this.onCoverSaveCallback&&this.onCoverSaveCallback()}onMainCoverDelete(){(0,a.curBox)().hide(),(0,s.hide)(this.mainCoverEditEl),(0,s.show)(this.mainCoverEl),(0,s.attr)(this.mainCoverImgEl,"src","")}onFileChange(e){this.uploadLive.pushFiles(e.files,this.liveCoverPosition),this.liveCoverPosition=-1}liveCoverUpload(e,t){this.liveInputEl.click()}liveCoverDelete(e){(0,n.cancelEvent)(e);var t=e.target,i=(0,s.domData)(t,"cover-id");this.deleteLiveCover(i,t)}deleteLiveCover(e,t){if(this.deleteLock||(this.deleteLock=[]),this.deleteLock[e])return!1;var i={};return t&&(i={onDone:this.onLiveCoverDelete.bind(this,t),showProgress:()=>this.deleteLock[e]=!0,hideProgress:()=>this.deleteLock[e]=!1}),ajax.post("groupsedit_cover.php",{act:"a_delete_live",id:this.groupId,cover_id:e,hash:this.deleteHash},i),!1}liveCoverChange(e){(0,n.cancelEvent)(e);var t=e.target,i=(0,s.domData)(t,"cover-id");this.reUploadCoverId=i;var o=this.getCoverPosition(i);this.liveCoverPosition=o,this.liveInputEl.click()}onLiveCoverDelete(e){var t=(0,s.domPN)((0,s.domPN)((0,s.domPN)(e))),i=(0,s.geByTag1)("img",t);(0,s.removeClass)(t,"edit"),this.getLiveCoversCount()<4?(0,s.addClass)(t,"disabled"):(0,s.removeClass)(t,"disabled"),(0,s.attr)(i,"src","");var o=t.cloneNode(!0);(0,s.re)(t),(0,s.domQuery1)("#live_covers_for_drag",this.box.bodyNode).appendChild(o),this.uploadLive.setCurFilesCount(this.getLiveCoversCount()),this.initSorter(),this.initLiveCoverEvents()}editDone(e){this.uploadMain.cropDone(e)}uploadReturn(){(0,s.hide)(this.mainCoverCropEl),(0,s.hide)(this.mainCoverEl),this.box.setOptions({width:p.COVER_UPLOAD_WIDTH}),(0,s.show)(this.contentEl),(0,s.show)(this.headerEl),(0,s.hide)(this.mainCoverEditEl),""==(0,s.attr)(this.mainCoverImgEl,"src")?((0,s.show)(this.mainCoverEl),(0,s.hide)(this.mainCoverEditEl),(0,s.show)(this.mainCoverUploadPlaceholder)):((0,s.hide)(this.mainCoverEl),(0,s.show)(this.mainCoverEditEl)),this.box.updateBoxCoords()}initSorter(){if(this.getLiveCoversCount()<=1)return!1;var e={canDrag:!0,clsUp:"groups_edit_cover_wrap_live_upload_preview_drag",onReorder:this.onReorder.bind(this)};window.usorter.init("live_covers_to_drag",e)}onReorder(){if(!this.saveReorderLock){var e=(0,s.domQuery1)("#live_covers_to_drag",this.box.bodyNode),t=(0,s.geByClass)("groups_edit_cover_wrap_live_upload",e).map((e=>(0,s.domData)(e,"cover-id")));ajax.post("groupsedit_cover.php",{act:"a_reorder_live",id:this.groupId,hash:this.reorderHash,covers:t},{showProgress:()=>this.saveReorderLock=!0,hideProgress:()=>this.saveReorderLock=!1})}}getLiveLoadedCover(){var e=(0,s.domQuery)(".groups_edit_cover_wrap_live_upload",this.liveWrapEl);for(var t in e)if(e[t]){var i=e[t];if((0,s.hasClass)(i,v))return i}return!1}getCoverPosition(e){var t=(0,s.domQuery)(".groups_edit_cover_wrap_live_upload",this.liveWrapEl);for(var i in t)if(t[i]){var o=t[i];if(e&&(0,s.domData)(o,"cover-id")==e)return parseInt(i)+1}return!1}getCoverWrapByCoverId(e){var t=(0,s.domQuery)(".groups_edit_cover_wrap_live_upload",this.box.bodyNode);for(var i in t)if(t[i]){var o=t[i];if((0,s.domData)(o,"cover-id")==e)return o}return!1}getNearestLiveCover(e){(0,r.isUndefined)(e)&&(e=0);var t=(0,s.domQuery)(".groups_edit_cover_wrap_live_upload:not(.edit)",this.box.bodyNode);return!!t[e]&&t[e]}onUploadErrorLiveCover(e,t){if(!t){var i=this.getLiveLoadedCover();(0,s.removeClass)(i,v),(0,s.removeClass)(i,"disabled")}return(0,d.showFastBox)((0,o.getLang)("global_error"),e)}onDidUploadedLiveCover(e){var t,i=e.story.preview;t=this.reUploadCoverId?this.getCoverWrapByCoverId(this.reUploadCoverId):this.getNearestLiveCover();var o=(0,s.geByTag1)("img",t);((0,s.attr)(o,"src",i),(0,s.removeClass)(t,v),(0,s.addClass)(t,"edit"),e.story.isVideo)?((0,s.addClass)(t,"video"),(0,s.removeClass)(t,"photo"),e.story.isProcessing&&(0,s.addClass)(t,"processing"),(0,s.geByClass1)("page_cover_action",(0,s.geByClass1)("video_size",t)).innerHTML=e.story.videoDuration):((0,s.removeClass)(t,"video"),(0,s.addClass)(t,"photo"));if((0,s.addClass)(t,"edit"),(0,s.domData)(t,"cover-id",e.storyRaw),(0,s.domData)((0,s.geByClass1)("upload",t),"cover-id",e.storyRaw),(0,s.domData)((0,s.geByClass1)("delete",t),"cover-id",e.storyRaw),!this.reUploadCoverId){var r=t.cloneNode(!0);(0,s.re)(t),this.liveWrapToDrag.appendChild(r),t=this.getNearestLiveCover(),(0,s.removeClass)(t,"disabled"),this.uploading=!1,this.uploadLive.setCurFilesCount(this.getLiveCoversCount()),this.initSorter()}this.reUploadCoverId=0,this.initLiveCoverEvents()}onUploadStartLiveCover(e){var t;this.reUploadCoverId?(t=this.getCoverWrapByCoverId(this.reUploadCoverId),(0,s.removeClass)(t,"edit")):t=this.getNearestLiveCover(e),(0,s.removeClass)(t,"disabled"),(0,s.addClass)(t,v)}dragDidEnter(e){return e.dataTransfer&&(e.dataTransfer.items&&e.dataTransfer.items.length>0&&"file"===e.dataTransfer.items[0].kind||e.dataTransfer.types&&e.dataTransfer.types.indexOf("Files")>-1)&&(clearTimeout(this.DragLeaveTimer),(0,s.addClass)(this.liveWrapEl,"drop")),(0,n.cancelEvent)(e)}dragDidLeave(e){return clearTimeout(this.DragLeaveTimer),this.DragLeaveTimer=setTimeout((()=>{(0,s.removeClass)(this.liveWrapEl,"drop")}),100),(0,n.cancelEvent)(e)}dragDidDrop(e){return this.dragDidLeave(e),e&&e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0&&this.uploadLive.pushFiles(e.dataTransfer.files),(0,n.cancelEvent)(e)}getLiveCoversCount(){var e=(0,s.geByClass)("edit",(0,s.domQuery1)("#live_covers_to_drag",this.box.bodyNode)),t=0;return e&&(t=e.length),t}setScalable(e,t){this.saveScalableLock||(this.saveScalableLock=!0,(0,l.checkbox)(e),ajax.post("groupsedit_cover.php",{act:"a_save_scalable",id:this.groupId,hash:t,scalable:(0,l.isChecked)(e)?1:0},{showProgress:()=>this.saveScalableLock=!0,hideProgress:()=>this.saveScalableLock=!1}))}}},30522:(e,t,i)=>{"use strict";i.d(t,{LiveCoverUploadEvents:()=>a,default:()=>d});var s=i(369175),o=i(70162),r=i(509204),a={onDidUploaded:"onUpload",onProgress:"onProgress",onStart:"onStart",onError:"onError"};class d{constructor(e,t,i,s,o,r){this.groupId=e,this.wrapEl=t,this.uploadHash=i,this.saveHash=s,this.emitter=o,this.filesCount=r}setCurFilesCount(e){this.filesCount=e}onDidUploaded(e){this.emitter.emit(a.onDidUploaded,e)}onDidProgress(e){this.emitter.emit(a.onProgress,e)}onDidFailed(e){this.emitter.emit(a.onError,(0,o.getLang)("groups_live_covers_error_upload_file_error"))}pushFiles(e,t){var i=!1;if(t>0&&(i=!0),e.length+this.filesCount>5&&!i)return this.emitter.emit(a.onError,(0,o.getLang)("groups_live_covers_error_upload_max_count_files")),!1;for(var d=0;d<e.length;d++){var n=e[d];if(n.size>31457280)this.emitter.emit(a.onError,(0,o.getLang)("groups_live_covers_error_upload_max_size"),!0);else{var l=new EventEmitter;l.on(s.UploaderEvents.didUploaded,this.onDidUploaded.bind(this)),l.on(s.UploaderEvents.didProgress,this.onDidProgress.bind(this)),l.on(s.UploaderEvents.didFailed,this.onDidFailed.bind(this));var h=new r.default(this.groupId,this.uploadHash,this.saveHash,n,l,1);this.emitter.emit(a.onStart,d),h.start(t)}}}}},691149:(e,t,i)=>{"use strict";i.d(t,{default:()=>p});i(241539),i(339714),i(804723),i(115306),i(923157);var s=i(897449),o=i(70162),r=i(520820),a=i(342269),d=i(873589),n=i(390787),l=i(146143),h=i(222519),c=i(733661);class p{constructor(e,t,i,s,o){this.emitter=o,this.groupId=e,this.thumbId=i,this.uploadOptions=this._getCoverUploadOptions(s,t),this.uploadEl=t,this.editOptions={},this.newEditOptions={},this.curEditOptions={},s.crop_options&&(this.editOptions=s.crop_options),this.mainCoverUpload=Upload.init(t,s.url,{},this.uploadOptions),this.coverCropDoneBtn=(0,d.ge)(n.COVER_CROP_DONE_BUTTON)}onUploadComplete(e,t,i){var s=(0,r.parseJSON)(t)||{};if(s.error)return this.showError(s.error),!1;var o=this._getCoverCropUrl(t),a=s.x_src;s.x_src.startsWith("http")||(a=this.uploadOptions.static_url+a);var d=(0,c.getOriginalURL)(s),n={thumb:a,thumbSize:s.x_size,size:s.size,uploadUrl:o,o_src:d};this.edit(!0,!0,n)}edit(e,t,i){if(!this.ownerPhotoThumb||t){var s=this.editOptions;(0,a.isUndefined)(i)||(s=i),this.curEditOptions=s,this.setCropWrap(s),this.ownerPhotoThumb=(0,d.ge)(n.COVER_UPLOAD_CROP_IMG_ID),window.stManager.add(["tagger.css",window.jsc("web/tagger.js")],this.initTagger.bind(this,s,e))}this.emitter.emit(n.MainCoverUploadEvents.onEditStart)}setCropWrap(e){var t=this.thumbId;(0,d.toggleClass)(t,"no_rotate");var i=this._getCropImageDiv(e);(0,d.val)(t,i)}initTagger(e,t){var i=this._getThumbOpts(e,t);this.ownerPhotoEditTagger&&this.ownerPhotoEditTagger.destroy(),this.ownerPhotoEditTagger=window.photoTagger(this.ownerPhotoThumb,i)}onCropSuccess(e,t,i){this.emitter.emit(n.MainCoverUploadEvents.onCropSuccess,i),h.TooltipEventService.onUploadCover()}cropDone(e){e&&(this.curEditOptions.rect=e,this.editOptions.rect=e);var t=e||this.ownerPhotoEditTagger.result(),i=this.curEditOptions,o=i.size[0]/i.thumbSize[0],r=i.size[1]/i.thumbSize[1],a=e||[Math.floor(t[0]*o),Math.floor(t[1]*r),Math.ceil(t[2]*o),Math.ceil(t[3]*r)],n=this.cropSuccess.bind(this,!0),l=i.uploadUrl+"&_full="+encodeURIComponent(a.join(","))+"&_rot=0";(0,s.lockButton)(this.coverCropDoneBtn),clearTimeout(this.ownerPhotoCropTimer),this.ownerPhotoCropTimer=setTimeout(this.cropSuccess.bind(this,!0,'{"error":"ERR_CLIENT_UPLOAD_TIMEOUT: no response on owner_photo_crop iframe request"}'),1e4),this.editOptions=i,window.stManager.add([window.jsc("web/upload.js")],(()=>{var e=[0,0,a[2]],t=window.jsonpManager.reg(n);window.utilsNode.appendChild((0,d.ce)("iframe",{src:l+"&_crop="+e.join(",")+"&_jsonp="+t+"&_origin="+encodeURIComponent(locProtocol+"//"+locHost)}))}))}cropSuccess(e,t){if(!0!==e&&(t=e,e=!1),clearTimeout(this.ownerPhotoCropTimer),((0,r.parseJSON)(t)||{}).error)return(0,s.unlockButton)(this.coverCropDoneBtn),console.log("done_edit error"),!1;var i={showProgress:s.lockButton.pbind(this.coverCropDoneBtn),hideProgress:s.unlockButton.pbind(this.coverCropDoneBtn),onDone:this.onCropSuccess.bind(this),onFail:this.onCropFail.bind(this)};ajax.post("al_page.php",{act:"owner_photo_save",_query:t,from:"groups_edit",gid:this.groupId},i)}onCropFail(e){return this.showError(e),!0}_getCropImageDiv(e){var t=e.thumbSize,i=t?"width: "+t[0]+"px; height: "+t[1]+"px;":"";return`<div id="owner_photo_rotate">\n        <div style="${i}margin: 0px auto;">\n          <img class="owner_photo_img" id="owner_photo_img" src="${e.thumb}" style="${i}"/>\n        </div>\n    </div>`}isAvailableBigCover(){return!0}_getCoverUploadOptions(e,t){var i={file_name:"photo",file_size_limit:n.COVER_UPLOAD_SIZE,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF",clear:1,type:"photo",max_attempts:3,signed:1,static_url:e.static_url,check_url:e.check_url,base_url:e.base_url,lang:e.lang,dropbox:(0,d.ge)("groups_edit_cover_wrap_main_wrap_drop"),onUploadStart:this.onUploadStart.bind(this),onUploadComplete:this.onUploadComplete.bind(this),onDragEnter:this.onDragEnter.bind(this),onDragOut:this.onDragOut.bind(this)};return"cover_ratio"in e&&(i.cover_ratio=e.cover_ratio),(null==e?void 0:e.hasOwnProperty("cover_ratio_size_a"))&&e.cover_ratio_size_a&&(i.cover_ratio_size_a=e.cover_ratio_size_a),(null==e?void 0:e.hasOwnProperty("cover_ratio_size_e"))&&e.cover_ratio_size_e&&(i.cover_ratio_size_e=e.cover_ratio_size_e),i}onUploadStart(){this.emitter.emit(n.MainCoverUploadEvents.onUploadStart)}onDragEnter(){this.emitter.emit(n.MainCoverUploadEvents.onDragEnter)}onDragOut(){this.emitter.emit(n.MainCoverUploadEvents.onDragOut)}_getCoverCropUrl(e){return this.uploadOptions.base_url+"upload.php?act=owner_cover_crop&_query="+encodeURIComponent(e)+"&_origin="+encodeURIComponent(window.locProtocol+"//"+window.locHost)}_getThumbOpts(e,t){var i,s=e.size,o=e.thumbSize,r=p.getOriginalRatioSize(this.uploadOptions,"a"),a=r[0],d=r[1],n=p.getOriginalRatioSize(this.uploadOptions,"e"),l=n[0],h=n[1],c=[Math.max(l,Math.ceil(a*o[0]/s[0])),Math.max(h,Math.ceil(d*o[1]/s[1]))];if(o[0]<c[0]||o[1]<c[1])return console.log("error"),!1;i=t?this._getRect(e):this._getRectStrict(e);var v=p.getCropRatio(this.uploadOptions);return{minw:c[0],minh:c[1],mina:v,maxa:v,rect:i,zstart:1e3}}static getCropRatio(e){return"cover_ratio"in e?e.cover_ratio:n.COVER_BIG_CROP_RATIO}static getOriginalRatioSize(e,t){var i=`cover_ratio_size_${t}`;return(null==e?void 0:e.hasOwnProperty(i))&&e[i]?e[i]:"a"===t?[795,200]:[200,50]}_getRectStrict(e){var t=e.size,i=e.thumbSize;return{left:Math.floor(e.rect[0]*i[0]/t[0]),top:Math.floor(e.rect[1]*i[1]/t[1]),width:Math.ceil(e.rect[2]*i[0]/t[0]),height:Math.ceil(e.rect[3]*i[1]/t[1])}}_getRect(e){var t,i=e.thumbSize,s=p.getCropRatio(this.uploadOptions);return i[1]>=i[0]/s?(t={width:i[0]}).height=Math.ceil(t.width/s):(t={height:i[1]},i[0]?t.width=i[0]:t.width=Math.ceil(t.height*s)),t.height>1.5*t.width&&(t.height=Math.floor(1.5*t.width)),t.left=Math.floor((i[0]-t.width)/2),t.top=Math.floor((i[1]-t.height)/2),t}showError(e){e.match(/^ERR_[A-Z0-9_]+(\:|$)/)||(e='ERR_CLIENT_BAD_ERROR: error "'+(0,a.clean)(e.toString())+'"');var t=e.match(/^(ERR_[A-Z0-9_]+)(\:\s*|$)([\S\s]*)\s*$/),i=t[1],s="",r=p.getOriginalRatioSize(this.uploadOptions,"a"),d=r[0],h=r[1];switch(i){case"ERR_UPLOAD_FILE_NOT_SUPPORTED":s=(0,o.getLang)("profile_oph_err_format");break;case"ERR_UPLOAD_FILE_NOT_UPLOADED":s=(0,o.getLang)("profile_oph_err_upload").replace("{link}",'<a href="/support?act=new&from=ph">').replace("{/link}","</a>");break;case"ERR_UPLOAD_BAD_IMAGE_SIZE":s=(0,o.getLang)("groups_cover_photo_error_size").replace("{width}",`${d}`).replace("{height}",`${h}`);break;case"ERR_UPLOAD_BIG_IMAGE_SIZE":s=(0,o.getLang)("groups_cover_big_error_size").replace("{size}","14000");break;case"ERR_STORAGE_ENGINE_NOT_CONNECTED":case"ERR_STORAGE_ENGINE_SAVE_FAILED":s=(0,o.getLang)("profile_oph_error_server");break;default:s=(0,o.getLang)("profile_oph_err_unknown").replace("{link}",'<a href="/support?act=new&from=ph">').replace("{/link}","</a>")}return s=s.replace("{sorry}","<b>"+(0,o.getLang)("global_sorry_error")+"</b>")+'<br><a onclick="OwnerPhoto.detailsError(this);">'+(0,o.getLang)("global_error_details")+'</a><div class="unshown">Error: '+i+(t[3]?". Details: "+t[3]:".")+"</div>",this.emitter.emit(n.MainCoverUploadEvents.onUploadError),(0,l.showFastBox)((0,o.getLang)("global_error"),s)}}},733661:(e,t,i)=>{"use strict";i.d(t,{showMessage:()=>r,getOriginalURL:()=>a});i(66992),i(241539),i(333948),i(560285);var s=i(873589),o=i(927766);function r(e,t,i){i=i||window.document;var r=(0,s.domQuery1)(".msg",i),a=(0,s.domFC)(r);if(a){a.innerHTML=e;var d="msg";d+=t?"info"===t?" info_msg":" error":" ok_msg",r.className=d,(0,s.show)(r),"error"==t&&(0,o.scrollToY)((0,s.getXY)(r)[1],500)}}var a=e=>{var t,i,s=null==e||null==(t=e.photo)?void 0:t.sizes2,o=null==e||null==(i=e.photo)?void 0:i.urls2;if(!s||!o||s.length!==o.length)return e.x_src;var r=s.findIndex((e=>"o"===e[0]));if(r<0)return e.x_src;var a=o[r],d=new URL(e.x_src);return d.pathname=a,d.href}},369175:(e,t,i)=>{"use strict";i.d(t,{Events:()=>o,UploaderEvents:()=>r,Constants:()=>a,UploadErrorTypes:()=>d,UploadStoryState:()=>n,UploadFileTypes:()=>h});i(66992),i(323123),i(333948);var s=i(285164),o={storyDidUploaded:"storyDidUploaded",storyDidUpload:"storyDidUpload",storyDidFailed:"storyDidFailed",storyDidRemove:"storyDidRemove",coverDidUploaded:"coverDidUploaded",coverDidUpload:"coverDidUpload",coverDidFailed:"coverDidFailed",pushUploadError:"pushUploadError"},r={didUploaded:"didUploaded",didDestroyed:"didDestroyed",didProgress:"didProgress",didUpload:"didUpload",didFailed:"didFailed",didRemove:"didRemove",uploadError:"uploadError"},a={maxTotalCount:50,uploadingMaxCount:2},d={unknown:1,securityError:2,internalError:3,noVideoStream:4,invalidVideoCodec:5,invalidAudioCodec:6,toLongStory:7,bigFile:8},n={waiting:"waiting",uploading:"uploading",finished:"finished",failed:"failed"},l=s.VIDEO_UPLOAD_EXTS,h=[..."jpg jpeg png gif bmp heic heif webp".split(" "),...l]},509204:(e,t,i)=>{"use strict";i.d(t,{default:()=>h});i(66992),i(241539),i(333948),i(560285);var s=i(369175),o=i(679740),r=i(342269),a=i(180391),d=i(961540),n=5,l=200;class h{constructor(e,t,i,o,r,a){this.groupId=e,this.uploadHash=t,this.saveHash=i,this.file=o,this.emitter=r,this.state=s.UploadStoryState.waiting,this.story={},this.uploadProgressVal=n,this.liveCover=a}start(e){this._isPhoto()?this.startWithMetadata(0,e):(0,d.getVideoDuration)(window.URL.createObjectURL(this.file)).then((t=>this.startWithMetadata(t,e))).catch((()=>this.startWithMetadata(0,e)))}startWithMetadata(e,t){this.state=s.UploadStoryState.uploading;var i={act:"stories_get_upload_url",id:this.groupId,type:this._isPhoto()?"photo":"video",hash:this.uploadHash,live_cover:this.liveCover,file_size:this.file.size,duration:Math.round(e)};(0,r.isUndefined)(t)||(i.position=t),ajax.post("groupsedit.php",i,{onDone:e=>{this.uploadUrl=e,this.state===s.UploadStoryState.uploading&&this.upload()},onFail:e=>(this._storyUploadDidFailed(e||{unknown:!0}),!0)})}upload(){this.xhr=new XMLHttpRequest,this.xhr.upload.onprogress=this._uploadDidProgress.bind(this),this.xhr.onload=this.xhr.onerror=this._uploadDidFinish.bind(this),this.xhr.open("POST",this.uploadUrl,!0);var e=new FormData;e.append(this._isPhoto()?"file":"video_file",this.file),this.xhr.send(e)}destroy(){try{this.xhr&&this.xhr.abort(),this.xhr=!1}catch(e){}this.emitter.emit(s.UploaderEvents.didDestroyed,this)}_uploadDidProgress(e){var t=e.loaded/e.total;this.uploadProgressVal=(l-n)*t+n,this.emitter.emit(s.UploaderEvents.didProgress,this)}_uploadDidFinish(){if(200===this.xhr.status){var e=JSON.parse(this.xhr.responseText);e&&e.response&&e.response.upload_result?ajax.post("groupsedit.php",{act:"stories_save",group_id:this.groupId,hash:this.saveHash,upload_result:e.response.upload_result},{onDone:e=>{e&&e.story?(this.state=s.UploadStoryState.finished,this._storyUploadDidFinish(e.story)):this._storyUploadDidFailed({unknown:!0})},onFail:()=>{this._storyUploadDidFailed({unknown:!0})}}):this._storyUploadDidFailed(e.error)}else this._storyUploadDidFailed({unknown:!0});this.xhr=!1}_storyUploadDidFinish(e){this.storyRaw=`${e.owner_id}_${e.id}`;var t="video"===e.type,i=t?e.video.first_frame_320||e.video.photo_320:(0,a.getPhotoUrl)(e.photo,"x");this.story={isProcessing:t&&e.video.processing,preview:i,isVideo:t,videoDuration:t?(0,o.formatTime)(e.video.duration):""},this.emitter.emit(s.UploaderEvents.didUploaded,this)}_storyUploadDidFailed(e){e.unknown||"flood"===e.type?this.state=s.UploadStoryState.failed:(this.emitter.emit(s.UploaderEvents.pushUploadError,this,e),this.emitter.emit(s.UploaderEvents.didRemove,this)),this.emitter.emit(s.UploaderEvents.didFailed,this)}_isPhoto(){return"image"===this.file.type.substr(0,5)}}},180391:(e,t,i)=>{"use strict";i.d(t,{getPhotoUrl:()=>s});i(57327),i(873589),i(608021),i(290846);function s(e,t){if(e&&e.sizes)return(e.sizes.filter((e=>e.type===t))[0]||{}).url}},487976:(e,t,i)=>{"use strict";i.d(t,{PlacesSelect:()=>a});var s=i(873589),o=i(342269),r=i(70162);function a(e,t,i){if(null==e)return!1;var a={show:s.show,hide:s.hide,forceEnableCustom:0,multiselect:!1,selectedItems:"",visible:!0,dropdown:!1,city:0,street:0,place:0,placeholder:(0,r.getLang)("global_select_address_or_place"),introText:(0,r.getLang)("select_place_select"),noResult:(0,r.getLang)("select_place_select"),showAddress:0,showCreateNewPlace:0};function d(){var e="/select_ajax.php?act=a_get_places2";return i.longitude&&i.latitude&&(e+="&longitude="+i.longitude+"&latitude="+i.latitude),i.showAddress&&(e+="&with_address=1"),i.showCreateNewPlace&&(e+="&show_create_new=1"),e}(i=(0,o.extend)(a,i)).enableCustom=i.forceEnableCustom>=0,i.city=(0,o.intval)(i.city),i.showAddress=(0,o.intval)(i.showAddress),i.showCreateNewPlace=(0,o.intval)(i.showCreateNewPlace);var n=new window.Selector(e,d(),i);function l(){n.old_setOptions({onChange:function(e){if(i.place=n.val_full(),i.showCreateNewPlace&&"new"==e&&(0,o.isFunction)(i.onCreateNew)){var t="";return i.place[3]&&(t=i.place[3]),void i.onCreateNew(t)}(0,o.intval)(e)||n.clear(),(0,o.isFunction)(i.onChange)&&i.onChange(e)}})}function h(){i.visible&&i.city?i.show(t):i.hide(t)}if(n.old_setOptions=n.setOptions,n.setOptions=function(e){if((0,o.extend)(i,e),n.old_setOptions(e),"onChange"in e&&l(),"latitude"in e||"longitude"in e)if(i.city=(0,o.intval)(i.city),n.setURL(d()),(0,o.intval)(i.place)){if(!(0,o.intval)(n.val())){var t=i.multiselect?i.place:[i.place];for(var s in t)n.val(t[s])}}else"city"in e&&n.clear();("city"in e||"visible"in e)&&h()},n.show=function(){n.setOptions({visible:!0})},n.hide=function(){n.setOptions({visible:!1})},n.zero=function(){i.multiselect&&n.clear(),n.val("",!0)},(0,o.intval)(i.place)){var c=i.multiselect?i.place:[i.place];for(var p in c)n.val(c[p])}else n.clear();return h(),l(),n}},797350:(e,t,i)=>{"use strict";i.d(t,{ClickAnalytics:()=>r});var s=i(971530),o=i(823081),r=function(){function e(e){void 0===e&&(e=new o.ClickEventCollector),this.collector=e}return e.prototype.logChecklistClick=function(e){var t,i=e.groupId,o=e.type;this.collector.logEvent({params:(t={type:s.EventName.CHECKLIST_CLICK,community_id:i},t[s.EventName.CHECKLIST_CLICK]={checklist_type:o},t)})},e.prototype.logChecklistMainClick=function(e){var t=e.groupId;this.collector.logEvent({params:{type:s.EventName.CHECKLIST_MAIN_CLICK,community_id:t}})},e}()},823081:(e,t,i)=>{"use strict";i.d(t,{ClickEventCollector:()=>d});var s=i(570655),o=i(214547),r=i(740517),a=i(971530),d=function(){function e(e){void 0===e&&(e=new o.ProductionStatCollector),this.statCollector=e,this.lastNavEventId=0}return e.prototype.logEvent=function(e){var t=e.params,i=this.constructEvent({params:t});this.statCollector.logEvent(i),this.lastNavEventId=i.id},e.prototype.constructEvent=function(e){var t,i,o=e.params,d=this.statCollector.getBaseEvent();return(t={id:d.id,timestamp:d.timestamp,type:r.ProductionStatEventTypes.TYPE_CLICK,prev_nav_id:this.lastNavEventId,prev_event_id:d.prev_id||0,screen:a.Screen.GROUP})[r.ProductionStatEventTypes.TYPE_CLICK]=((i={type:a.EventType.TYPE_CLICK})[a.EventType.TYPE_CLICK]=(0,s.__assign)({},o),i),t},e}()},304927:(e,t,i)=>{"use strict";i.d(t,{clickAnalytics:()=>s});var s=new(i(797350).ClickAnalytics)},971530:(e,t,i)=>{"use strict";i.d(t,{Screen:()=>s,EventType:()=>o,EventName:()=>r});var s,o,r;i(740517);!function(e){e.GROUP="group"}(s||(s={})),function(e){e.TYPE_CLICK="type_admin_tips_click"}(o||(o={})),function(e){e.CHECKLIST_CLICK="type_admin_tips_checklist_click",e.CHECKLIST_MAIN_CLICK="type_admin_tips_checklist_main_click"}(r||(r={}))},285164:(e,t,i)=>{"use strict";i.d(t,{SHORT_VIDEO_UPLOAD_EXTS:()=>r,VIDEO_UPLOAD_EXTS:()=>a,VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>d,CLIP_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>n,VIDEO_UPLOAD_CHUNK_SIZE:()=>l,VIDEO_UPLOAD_FILE_THREAD_NUMBER:()=>h,VIDEO_UPLOAD_CHUNK_MAX_RETRY_NUMBER:()=>c,VIDEO_UPLOAD_SUBTITLES_DISABLED:()=>p,VIDEO_UPLOAD_SUBTITLES_USER_LANG:()=>v});var s=i(570655),o=i(840060),r="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),a=(0,s.__spreadArray)((0,s.__spreadArray)([],(0,s.__read)(r),!1),["torrent"],!1);"avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf torrent".split(" ");o.browser.safari||r.join(",.");var d=5,n=1,l=4194304,h=4,c=10,p=-1,v=-2},222519:(e,t,i)=>{"use strict";i.d(t,{TOOLTIP_SUCCESS_EVENT:()=>o,TooltipEventService:()=>r});var s=i(340189),o="group_tooltip_success_event",r={onUploadAvatar:function(){window.dispatchEvent(new CustomEvent(o,{detail:s.OnboardingTooltipIds.Avatar}))},onUploadCover:function(){window.dispatchEvent(new CustomEvent(o,{detail:s.OnboardingTooltipIds.Cover}))},onAddPost:function(){window.dispatchEvent(new CustomEvent(o,{detail:s.OnboardingTooltipIds.Post}))},onAddMarketItem:function(){window.dispatchEvent(new CustomEvent(o,{detail:s.OnboardingTooltipIds.MarketItem}))},onAddServiceItem:function(){window.dispatchEvent(new CustomEvent(o,{detail:s.OnboardingTooltipIds.ServiceItem}))}}},340189:(e,t,i)=>{"use strict";var s;i.d(t,{OnboardingTooltipIds:()=>s}),function(e){e.Avatar="business_groups_web:avatar",e.Cover="business_groups_web:cover",e.ActionButton="business_groups_web:action_button",e.MarketItem="business_groups_web:add_item",e.ServiceItem="business_groups_web:add_service",e.Post="business_groups_web:make_post"}(s||(s={}))}}]);try{stManager.done("dist/f3e7f573cef792c75d7d389b53b4d92b.eed7dd01f23e91a5f61c.js")}catch(e){}